# Test List

- cross chain deployment of the wallet deployer system, check that all addresses are the same on each chain
- cross chain deployment, same contract addresses, different whitelisted calldata and addresses

## Scenario Test

- [ ] full Morpho Blue whitelisted calldata walkthrough
    - [x] supply collateral
    - [x] withdraw collateral
    - [x] borrow
    - [x] repay
    - [x] supply borrow asset
    - [x] withdraw borrow asset
- [x] deploy safe with timelock, guard, and recovery spell, safe owners enact malicious proposal, guardian pauses, recovery spell rotates signers, new transactions are sent
- [x] hot signers move funds from one DeFi protocol to another
- [x] hot signers get revoked by the Safe
- [ ] privilege escalation impossible by hot signers
- [x] mutative functions cannot be called while paused

# Formal Verification

- [x] impossible to have self calls whitelisted
- [x] pausing cancels all in flight proposals
- [x] not possible to have more than one admin
- [x] not possible to create new roles => implies no other roles outside of admin and hot signers can have any addresses in their list
- [x] timelock duration is always less than or equal to the maximum timelock duration, and always greater than or equal to the minimum timelock duration

## Proposal Invariants

- !isOperationExpired(id) => **timestamps[id]** > 1 => **_liveProposals** does contain id
- **timestamps[id]** == 1 => **_liveProposals** does not contain id


# Mutation Testing

Run unit, integration tests and formal verification spec against Timelock mutants generated by certora gambit

generate mutants:
```bash
gambit mutate --json certora/mutation/TimelockConfig.json
```

run tests against mutants:
```bash
sh run-timelock-mutation.sh
```

`run-timelock-mutation` will generate a readme file with testing results against each mutation. It shows failing unit tests, failing integration tests, whether the formal verification spec was violated, and provides a url to the certora prover run for each mutant. A total of 289 mutants are generated for the `Timelock` contract. It skips some of the mutants to avoid infinite looping, as in those mutants increment operator for a loop is replaced by assert(true). It also skips a few invariants and rules from the timelock spec which failed sanity checks on the original timelock contract. This is done so that when there is a further sanity check failure by a mutant the spec can be marked as violated.
